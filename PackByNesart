package packbynesart.mods;

import net.minecraft.client.Minecraft;
import net.minecraft.client.settings.KeyBinding;
import net.minecraft.entity.Entity;
import net.minecraft.entity.item.ArmorStandEntity;
import net.minecraft.entity.item.EnderCrystalEntity;
import net.minecraft.item.Items;
import net.minecraft.util.Hand;
import net.minecraft.util.math.AxisAlignedBB;
import net.minecraftforge.common.MinecraftForge;
import net.minecraftforge.event.TickEvent;
import net.minecraftforge.eventbus.api.SubscribeEvent;
import net.minecraftforge.fml.client.registry.ClientRegistry;
import net.minecraftforge.fml.common.Mod;
import net.minecraftforge.fml.event.lifecycle.FMLCommonSetupEvent;
import net.minecraftforge.fml.javafmlmod.FMLJavaModLoadingContext;
import org.lwjgl.glfw.GLFW;

@Mod("mods")
public class packbynesart {

    Minecraft mc = Minecraft.getInstance();
    public static KeyBinding keyObsidian;
    public static KeyBinding keyCrystal;
    public static int oldslot = 0;
    public static int delay = 0;
    public static KeyBinding keyPearl;
    public static KeyBinding enabled;
    public static KeyBinding ElytraSwap;
    private boolean Enabled = false;
    public packbynesart() {
        FMLJavaModLoadingContext.get().getModEventBus().addListener(this::setup);
        MinecraftForge.EVENT_BUS.register(this);
    }

    private void setup(final FMLCommonSetupEvent event) {
        keyObsidian = new KeyBinding("Use obsidian", GLFW.GLFW_KEY_Z, "ByNesart");
        ClientRegistry.registerKeyBinding(keyObsidian);
        keyCrystal = new KeyBinding("Use crystal", GLFW.GLFW_KEY_V, "ByNesart");
        ClientRegistry.registerKeyBinding(keyCrystal);
        enabled = new KeyBinding("Disable or Enable eating", GLFW.GLFW_KEY_N, "ByNesart");
        ClientRegistry.registerKeyBinding(enabled);
        keyPearl = new KeyBinding("Use pearl", GLFW.GLFW_KEY_X, "ByNesart");
        ClientRegistry.registerKeyBinding(keyPearl);
    }
    @SubscribeEvent
    public void onTick(TickEvent.ClientTickEvent e) {
        if(delay >= 1 && delay <= 6){
            delay++;
            KeyBinding.setKeyBindState(mc.gameSettings.keyBindUseItem.getKey(), false);
        }
        if(keyCrystal.isPressed()) {
            if (mc.player.getHeldItemMainhand().getItem() == Items.END_CRYSTAL) {
                KeyBinding.setKeyBindState(mc.gameSettings.keyBindUseItem.getKey(), true);
                delay = 2;
            }
            else{
                for (int i = 0; i < 9; i++) {
                    if (mc.player.inventory.getStackInSlot(i).getItem() == Items.END_CRYSTAL) {
                        if(oldslot == 0) {
                            oldslot = mc.player.inventory.currentItem;
                            delay = 1;
                        }
                        oldslot = mc.player.inventory.currentItem;
                        mc.player.inventory.currentItem = i;
                        KeyBinding.setKeyBindState(mc.gameSettings.keyBindUseItem.getKey(), true);
                        break;
                    }
                }
            }
        }
        if(keyObsidian.isPressed()) {
            if (mc.player.getHeldItemMainhand().getItem() == Items.OBSIDIAN) {
                KeyBinding.setKeyBindState(mc.gameSettings.keyBindUseItem.getKey(), true);
                delay = 4;
            }
            else{
                for (int i = 0; i < 9; i++) {
                    if (mc.player.inventory.getStackInSlot(i).getItem() == Items.OBSIDIAN) {
                        if(oldslot == 0) {
                            oldslot = mc.player.inventory.currentItem;
                            delay = 1;
                        }
                        mc.player.inventory.currentItem = i;
                        KeyBinding.setKeyBindState(mc.gameSettings.keyBindUseItem.getKey(), true);
                        break;
                    }
                }
            }
        }
        if(delay == 4){
            KeyBinding.setKeyBindState(mc.gameSettings.keyBindUseItem.getKey(), false);
            mc.player.inventory.currentItem = oldslot;
            oldslot = 0;
            delay = 0;
        }
        if (mc.world != null && mc.player != null){
            if (enabled.isPressed()) {
                Enabled = !Enabled;
            }
            if (Enabled) {
                for (Entity f : mc.world.getAllEntities()) {
                    if (f instanceof ArmorStandEntity || f instanceof EnderCrystalEntity)
                        f.setBoundingBox(new AxisAlignedBB(f.getPosX() - 0.1, f.getPosY(), f.getPosZ() - 0.1, f.getPosX() + 0.1, f.getPosY() + 0.1, f.getPosZ() + 0.1));
                }
            } else {
                for (Entity f : mc.world.getAllEntities()) {
                    if (f instanceof ArmorStandEntity)
                        f.setBoundingBox(new AxisAlignedBB(f.getPosX() - 0.3, f.getPosY(), f.getPosZ() - 0.3, f.getPosX() + 0.3, f.getPosY() + 1.8, f.getPosZ() + 0.3));
                }
                for (Entity f : mc.world.getAllEntities()) {
                    if (f instanceof EnderCrystalEntity)
                        f.setBoundingBox(new AxisAlignedBB(f.getPosX() - 1, f.getPosY(), f.getPosZ() - 1, f.getPosX() + 1, f.getPosY() + 2, f.getPosZ() + 1));
                }
            }
        }
        if(keyPearl.isPressed()) {
            if (mc.player.getHeldItemMainhand().getItem() == Items.ENDER_PEARL) {
                mc.playerController.processRightClick(mc.player, mc.world, Hand.MAIN_HAND);
            }
            else{
                for (int i = 0; i < 8; i++) {
                    if (mc.player.inventory.getStackInSlot(i).getItem() == Items.ENDER_PEARL) {
                        int o = mc.player.inventory.currentItem;
                        mc.player.inventory.currentItem = i;
                        mc.playerController.processRightClick(mc.player, mc.world, Hand.MAIN_HAND);
                        mc.player.inventory.currentItem = o;
                        break;
                    }
                }
            }
        }
    }
}
